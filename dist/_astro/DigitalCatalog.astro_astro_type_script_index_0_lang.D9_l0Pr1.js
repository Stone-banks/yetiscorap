document.addEventListener("DOMContentLoaded",()=>{const I=window.catalogData;if(!I)return;const{products:C,phoneNumber:F,itemsPerPage:d,lang:H}=I,m=document.getElementById("productList"),r=document.getElementById("mainProductImage"),$=document.getElementById("productCodeBadge"),k=document.getElementById("ageBadge"),P=document.getElementById("productTitle"),w=document.getElementById("productFeatures"),N=document.getElementById("productImageContainer"),b=document.getElementById("zoomModal"),O=document.getElementById("zoomOverlay"),R=document.getElementById("zoomCloseBtn"),p=document.getElementById("zoomImage"),x=document.getElementById("whatsappButton"),z=document.getElementById("quickWhatsappBtn"),f=document.querySelectorAll(".category-tab"),y=document.getElementById("prevPageBtn"),h=document.getElementById("nextPageBtn"),M=document.getElementById("pageCounter"),T=document.getElementById("pageNavigation"),i=document.getElementById("searchInput"),g=document.getElementById("clearSearchBtn"),q=document.getElementById("noResults"),j=document.getElementById("clearFiltersBtn");let o=0,a=[...C],B=0,s="",v="all";function u(){let t=[...C];if(v!=="all"&&(t=t.filter(e=>e.category===v)),s){const e=s.toLowerCase();t=t.filter(l=>l.code.toLowerCase().includes(e)||l.title.toLowerCase().includes(e))}a=t,o=0,B=0,E(),a.length>0?(A(0),q?.classList.add("hidden"),T?.classList.remove("hidden")):(q?.classList.remove("hidden"),T?.classList.add("hidden"))}function E(){if(!m)return;const t=o*d,e=Math.min(t+d,a.length),l=a.slice(t,e);m.innerHTML=l.map((n,c)=>`
        <div class="product-item ${t+c===B?"active":""}" data-index="${t+c}">
          <img src="${n.image}" alt="${n.title}" class="product-item-img" onerror="this.src='/images/placeholder.png'" loading="lazy" />
          <div class="product-item-info">
            <div class="product-item-code">${n.code}</div>
            <div class="product-item-title">${n.title}</div>
            <div class="product-item-age">${n.age}</div>
          </div>
        </div>
      `).join(""),m.querySelectorAll(".product-item").forEach(n=>{n.addEventListener("click",()=>{const c=parseInt(n.getAttribute("data-index")||"0");A(c)})}),D()}function D(){if(!M||a.length===0)return;const t=o*d+1,e=Math.min((o+1)*d,a.length);M.textContent=`${t}-${e} / ${a.length}`,y&&(y.disabled=o===0),h&&(h.disabled=(o+1)*d>=a.length)}function A(t){B=t;const e=a[t];if(!e)return;r&&(r.src=e.image,r.alt=e.title,r.onerror=()=>{r.src="/images/placeholder.png"}),$&&($.textContent=e.code),k&&(k.textContent=e.age),P&&(P.textContent=e.title),w&&(w.innerHTML=(e.features||[]).map(c=>`
          <span class="feature-tag">
            <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
            ${c}
          </span>
        `).join(""));const l=H==="tr"?`Merhaba, ${e.code} - ${e.title} (${e.age}) ürünü hakkında bilgi almak istiyorum.`:`Hello, I would like information about ${e.code} - ${e.title} (${e.age}).`,n=`https://wa.me/${F}?text=${encodeURIComponent(l)}`;x&&(x.href=n),z&&(z.href=n),p&&(p.src=e.image,p.alt=e.title),m?.querySelectorAll(".product-item").forEach(c=>{const Z=parseInt(c.getAttribute("data-index")||"0");c.classList.toggle("active",Z===t)})}function W(){b?.classList.add("active"),document.body.style.overflow="hidden"}function L(){b?.classList.remove("active"),document.body.style.overflow=""}N?.addEventListener("click",W),R?.addEventListener("click",L),O?.addEventListener("click",L),document.addEventListener("keydown",t=>{t.key==="Escape"&&L()}),f.forEach(t=>{t.addEventListener("click",()=>{f.forEach(e=>e.classList.remove("active")),t.classList.add("active"),v=t.getAttribute("data-category")||"all",u()})});let S;i?.addEventListener("input",()=>{clearTimeout(S),S=setTimeout(()=>{s=i.value.trim(),u(),g?.classList.toggle("hidden",!s)},300)}),g?.addEventListener("click",()=>{i&&(i.value=""),s="",u(),g.classList.add("hidden")}),j?.addEventListener("click",()=>{i&&(i.value=""),s="",v="all",f.forEach(t=>t.classList.remove("active")),document.querySelector('.category-tab[data-category="all"]')?.classList.add("active"),u(),g?.classList.add("hidden")}),y?.addEventListener("click",()=>{o>0&&(o--,E())}),h?.addEventListener("click",()=>{(o+1)*d<a.length&&(o++,E())}),u()});
