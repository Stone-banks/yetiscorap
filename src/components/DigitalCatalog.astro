---
/**
 * DigitalCatalog.astro
 * Profesyonel dijital ürün kataloğu - Arama ve Filtre ile
 */

import { getCollection } from 'astro:content';

interface Props {
  lang?: 'tr' | 'en';
}

const { lang = 'tr' } = Astro.props;

// Tüm ürünleri al
const allProducts = await getCollection('products', ({ id }) => {
  return id.startsWith(`${lang}/`);
});

// Ürün verilerini JSON formatına dönüştür
const productsData = allProducts.map((product) => ({
  code: product.data.sku || 'N/A',
  title: product.data.title || '',
  age: product.data.age_group || '',
  category: product.data.category || 'bebek',
  image: product.data.cover_image || '/images/placeholder.png',
  features: product.data.features || []
}));

// Metinler
const texts = {
  tr: {
    title: 'Ürün Kataloğu',
    subtitle: 'Ürüne tıklayarak detayları görüntüleyin',
    searchPlaceholder: 'Ürün kodu veya isim ara...',
    allProducts: 'Tüm Ürünler',
    babyProducts: 'Bebek Çorapları',
    childProducts: 'Çocuk Çorapları',
    askWhatsapp: 'WhatsApp ile Bilgi Al',
    clickToZoom: 'Büyütmek için tıklayın',
    noResults: 'Sonuç bulunamadı',
    clearSearch: 'Aramayı Temizle'
  },
  en: {
    title: 'Product Catalog',
    subtitle: 'Click on a product to view details',
    searchPlaceholder: 'Search by code or name...',
    allProducts: 'All Products',
    babyProducts: 'Baby Socks',
    childProducts: 'Children Socks',
    askWhatsapp: 'Get Info via WhatsApp',
    clickToZoom: 'Click to zoom',
    noResults: 'No results found',
    clearSearch: 'Clear Search'
  }
};

const t = texts[lang];
const phoneNumber = '905369205969';
const itemsPerPage = 6;
---

<section id="catalogSection" class="catalog-section">
  <div class="container py-12 md:py-16 lg:py-20">
    <!-- Header -->
    <div class="text-center mb-8 md:mb-12">
      <span class="inline-block px-4 py-1.5 rounded-full bg-blue-100 text-blue-600 text-sm font-medium mb-4">
        Dijital Katalog
      </span>
      <h2 class="heading-xl mb-4">{t.title}</h2>
      <p class="text-body-lg max-w-2xl mx-auto">{t.subtitle}</p>
    </div>

    <!-- Search & Filter Bar -->
    <div class="flex flex-col md:flex-row gap-4 mb-8">
      <!-- Search Input -->
      <div class="relative flex-1 max-w-md mx-auto md:mx-0">
        <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <input 
          type="text" 
          id="searchInput"
          placeholder={t.searchPlaceholder}
          class="w-full pl-12 pr-10 py-3 rounded-full border border-slate-200 focus:border-pink-500 focus:ring-2 focus:ring-pink-500/20 outline-none transition-all"
        />
        <button 
          id="clearSearchBtn"
          class="absolute right-3 top-1/2 -translate-y-1/2 p-1.5 rounded-full text-slate-400 hover:text-slate-600 hover:bg-slate-100 hidden"
        >
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <!-- Category Tabs -->
      <div class="flex justify-center md:justify-end gap-2 flex-wrap" id="categoryTabs">
        <button class="category-tab active" data-category="all">{t.allProducts}</button>
        <button class="category-tab" data-category="bebek">{t.babyProducts}</button>
        <button class="category-tab" data-category="cocuk">{t.childProducts}</button>
      </div>
    </div>

    <!-- Catalog Container -->
    <div class="catalog-grid">
      <!-- Left Panel - Product List -->
      <div class="left-panel">
        <div class="product-list" id="productList"></div>
        
        <!-- No Results -->
        <div class="no-results hidden" id="noResults">
          <svg class="w-12 h-12 text-slate-300 mx-auto mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <p class="text-white/70">{t.noResults}</p>
          <button id="clearFiltersBtn" class="mt-3 text-sm text-pink-300 hover:text-pink-200">{t.clearSearch}</button>
        </div>
        
        <!-- Pagination -->
        <div class="page-nav" id="pageNavigation">
          <button class="page-btn" id="prevPageBtn" disabled>
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <span class="page-count" id="pageCounter">1-6 / 6</span>
          <button class="page-btn" id="nextPageBtn">
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
            </svg>
          </button>
        </div>
      </div>
      
      <!-- Right Panel - Product Detail -->
      <div class="right-panel">
        <div class="image-box" id="productImageContainer">
          <img src="/images/placeholder.png" alt="Ürün" id="mainProductImage" class="main-image" />
          <div class="badges">
            <span class="badge badge-pink" id="ageBadge">3 Yaş</span>
            <span class="badge badge-blue" id="productCodeBadge">KOD 01</span>
          </div>
          <div class="zoom-tip">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7" />
            </svg>
            <span>{t.clickToZoom}</span>
          </div>
        </div>
        
        <div class="product-detail">
          <h3 class="detail-title" id="productTitle">Ürün Başlığı</h3>
          <div class="detail-features" id="productFeatures"></div>
          <a href="#" id="quickWhatsappBtn" target="_blank" rel="noopener noreferrer" class="whatsapp-btn">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
            </svg>
            <span>{t.askWhatsapp}</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Zoom Modal -->
<div class="zoom-modal" id="zoomModal">
  <div class="zoom-bg" id="zoomOverlay"></div>
  <div class="zoom-content">
    <button class="zoom-close" id="zoomCloseBtn">
      <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
    <img src="/images/placeholder.png" alt="Zoom" id="zoomImage" class="zoom-img" />
    <a href="#" id="whatsappButton" target="_blank" rel="noopener noreferrer" class="zoom-whatsapp">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
      </svg>
      <span>{t.askWhatsapp}</span>
    </a>
  </div>
</div>

<!-- Data -->
<script is:inline define:vars={{ productsData, phoneNumber, itemsPerPage, lang }}>
  window.catalogData = { products: productsData, phoneNumber, itemsPerPage, lang };
</script>

<style>
  .catalog-section { background: linear-gradient(180deg, #f8fafc 0%, #fff 100%); }
  
  .category-tab {
    padding: 10px 20px;
    border-radius: 9999px;
    background: white;
    border: 1px solid #e2e8f0;
    color: #475569;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }
  .category-tab:hover { border-color: #ec4899; color: #ec4899; }
  .category-tab.active { background: #ec4899; border-color: #ec4899; color: white; }

  .catalog-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 24px;
  }
  @media (min-width: 768px) {
    .catalog-grid { grid-template-columns: 320px 1fr; gap: 32px; }
  }
  @media (min-width: 1024px) {
    .catalog-grid { grid-template-columns: 360px 1fr; }
  }

  .left-panel {
    background: linear-gradient(180deg, #1e3a5f 0%, #2563eb 100%);
    border-radius: 16px;
    padding: 20px;
    display: flex;
    flex-direction: column;
    max-height: 600px;
  }
  @media (min-width: 768px) { .left-panel { max-height: 700px; } }

  .product-list {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .product-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: rgba(255,255,255,0.1);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s;
    border: 2px solid transparent;
  }
  .product-item:hover { background: rgba(255,255,255,0.15); transform: translateX(4px); }
  .product-item.active { background: rgba(255,255,255,0.2); border-color: white; }

  .product-item-img {
    width: 56px;
    height: 56px;
    border-radius: 10px;
    object-fit: cover;
    background: rgba(255,255,255,0.1);
    flex-shrink: 0;
  }

  .product-item-info { flex: 1; min-width: 0; }
  .product-item-code { font-size: 15px; font-weight: 700; color: white; }
  .product-item-title { font-size: 12px; color: rgba(255,255,255,0.7); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .product-item-age { font-size: 11px; color: rgba(255,255,255,0.5); margin-top: 2px; }

  .no-results { text-align: center; padding: 40px 20px; }

  .page-nav {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid rgba(255,255,255,0.15);
  }
  .page-btn {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255,255,255,0.15);
    border: none;
    border-radius: 10px;
    color: white;
    cursor: pointer;
    transition: all 0.2s;
  }
  .page-btn:hover:not(:disabled) { background: rgba(255,255,255,0.25); }
  .page-btn:disabled { opacity: 0.4; cursor: not-allowed; }
  .page-count { font-size: 13px; color: rgba(255,255,255,0.8); font-weight: 500; }

  .right-panel {
    background: white;
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    border: 1px solid #e2e8f0;
  }

  .image-box {
    position: relative;
    width: 100%;
    aspect-ratio: 4/3;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
    margin-bottom: 20px;
  }
  @media (min-width: 768px) { .image-box { aspect-ratio: 16/10; } }

  .main-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    padding: 16px;
    transition: transform 0.3s;
  }
  .image-box:hover .main-image { transform: scale(1.03); }

  .badges {
    position: absolute;
    top: 12px;
    right: 12px;
    display: flex;
    gap: 8px;
  }
  .badge {
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    backdrop-filter: blur(8px);
  }
  .badge-pink { background: rgba(236,72,153,0.9); color: white; }
  .badge-blue { background: rgba(59,130,246,0.9); color: white; }

  .zoom-tip {
    position: absolute;
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 6px;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(4px);
    padding: 6px 14px;
    border-radius: 20px;
    color: white;
    font-size: 12px;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .image-box:hover .zoom-tip { opacity: 1; }

  .product-detail { padding-top: 4px; }
  .detail-title { font-size: 22px; font-weight: 700; color: #1e293b; margin-bottom: 12px; }
  .detail-features { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
  .feature-tag {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 5px 12px;
    background: #eff6ff;
    border-radius: 20px;
    color: #3b82f6;
    font-size: 12px;
    font-weight: 500;
  }
  .feature-tag svg { width: 12px; height: 12px; }

  .whatsapp-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    padding: 14px 24px;
    background: #22c55e;
    color: white;
    font-size: 15px;
    font-weight: 600;
    border-radius: 12px;
    text-decoration: none;
    transition: all 0.2s;
    box-shadow: 0 4px 12px rgba(34,197,94,0.3);
  }
  .whatsapp-btn:hover { background: #16a34a; transform: translateY(-2px); }

  .zoom-modal { display: none; position: fixed; inset: 0; z-index: 1000; }
  .zoom-modal.active { display: flex; align-items: center; justify-content: center; }
  .zoom-bg { position: absolute; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(4px); }
  .zoom-content {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
    padding: 20px;
    z-index: 1;
    max-width: 90vw;
  }
  .zoom-close {
    position: absolute;
    top: -50px;
    right: 0;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 50%;
    color: white;
    cursor: pointer;
    transition: all 0.2s;
  }
  .zoom-close:hover { background: rgba(255,255,255,0.2); }
  .zoom-img { max-width: 80vw; max-height: 70vh; object-fit: contain; border-radius: 12px; background: white; }
  .zoom-whatsapp {
    display: flex;
    align-items: center;
    gap: 10px;
    background: #22c55e;
    padding: 14px 32px;
    border-radius: 12px;
    color: white;
    font-size: 16px;
    font-weight: 700;
    text-decoration: none;
    transition: all 0.2s;
    box-shadow: 0 4px 20px rgba(34,197,94,0.4);
  }
  .zoom-whatsapp:hover { background: #16a34a; transform: translateY(-2px); }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const data = (window as any).catalogData;
    if (!data) return;
    
    const { products, phoneNumber, itemsPerPage, lang } = data;
    
    const productList = document.getElementById('productList');
    const mainProductImage = document.getElementById('mainProductImage') as HTMLImageElement | null;
    const productCodeBadge = document.getElementById('productCodeBadge');
    const ageBadge = document.getElementById('ageBadge');
    const productTitle = document.getElementById('productTitle');
    const productFeatures = document.getElementById('productFeatures');
    const productImageContainer = document.getElementById('productImageContainer');
    const zoomModal = document.getElementById('zoomModal');
    const zoomOverlay = document.getElementById('zoomOverlay');
    const zoomCloseBtn = document.getElementById('zoomCloseBtn');
    const zoomImage = document.getElementById('zoomImage') as HTMLImageElement | null;
    const whatsappButton = document.getElementById('whatsappButton') as HTMLAnchorElement | null;
    const quickWhatsappBtn = document.getElementById('quickWhatsappBtn') as HTMLAnchorElement | null;
    const categoryTabs = document.querySelectorAll('.category-tab');
    const prevPageBtn = document.getElementById('prevPageBtn') as HTMLButtonElement | null;
    const nextPageBtn = document.getElementById('nextPageBtn') as HTMLButtonElement | null;
    const pageCounter = document.getElementById('pageCounter');
    const pageNavigation = document.getElementById('pageNavigation');
    const searchInput = document.getElementById('searchInput') as HTMLInputElement | null;
    const clearSearchBtn = document.getElementById('clearSearchBtn');
    const noResults = document.getElementById('noResults');
    const clearFiltersBtn = document.getElementById('clearFiltersBtn');
    
    let currentPage = 0;
    let filteredProducts = [...products];
    let activeProductIndex = 0;
    let searchQuery = '';
    let activeCategory = 'all';
    
    function filterProducts() {
      let result = [...products];
      if (activeCategory !== 'all') {
        result = result.filter((p: any) => p.category === activeCategory);
      }
      if (searchQuery) {
        const q = searchQuery.toLowerCase();
        result = result.filter((p: any) => p.code.toLowerCase().includes(q) || p.title.toLowerCase().includes(q));
      }
      filteredProducts = result;
      currentPage = 0;
      activeProductIndex = 0;
      renderProductList();
      
      if (filteredProducts.length > 0) {
        selectProduct(0);
        noResults?.classList.add('hidden');
        pageNavigation?.classList.remove('hidden');
      } else {
        noResults?.classList.remove('hidden');
        pageNavigation?.classList.add('hidden');
      }
    }
    
    function renderProductList() {
      if (!productList) return;
      const start = currentPage * itemsPerPage;
      const end = Math.min(start + itemsPerPage, filteredProducts.length);
      const pageProducts = filteredProducts.slice(start, end);
      
      productList.innerHTML = pageProducts.map((p: any, i: number) => `
        <div class="product-item ${start + i === activeProductIndex ? 'active' : ''}" data-index="${start + i}">
          <img src="${p.image}" alt="${p.title}" class="product-item-img" onerror="this.src='/images/placeholder.png'" loading="lazy" />
          <div class="product-item-info">
            <div class="product-item-code">${p.code}</div>
            <div class="product-item-title">${p.title}</div>
            <div class="product-item-age">${p.age}</div>
          </div>
        </div>
      `).join('');
      
      productList.querySelectorAll('.product-item').forEach(item => {
        item.addEventListener('click', () => {
          const idx = parseInt(item.getAttribute('data-index') || '0');
          selectProduct(idx);
        });
      });
      
      updatePageCounter();
    }
    
    function updatePageCounter() {
      if (!pageCounter || filteredProducts.length === 0) return;
      const start = currentPage * itemsPerPage + 1;
      const end = Math.min((currentPage + 1) * itemsPerPage, filteredProducts.length);
      pageCounter.textContent = `${start}-${end} / ${filteredProducts.length}`;
      if (prevPageBtn) prevPageBtn.disabled = currentPage === 0;
      if (nextPageBtn) nextPageBtn.disabled = (currentPage + 1) * itemsPerPage >= filteredProducts.length;
    }
    
    function selectProduct(index: number) {
      activeProductIndex = index;
      const p = filteredProducts[index];
      if (!p) return;
      
      if (mainProductImage) {
        mainProductImage.src = p.image;
        mainProductImage.alt = p.title;
        mainProductImage.onerror = () => { mainProductImage.src = '/images/placeholder.png'; };
      }
      if (productCodeBadge) productCodeBadge.textContent = p.code;
      if (ageBadge) ageBadge.textContent = p.age;
      if (productTitle) productTitle.textContent = p.title;
      
      if (productFeatures) {
        productFeatures.innerHTML = (p.features || []).map((f: string) => `
          <span class="feature-tag">
            <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
            ${f}
          </span>
        `).join('');
      }
      
      const msg = lang === 'tr' 
        ? `Merhaba, ${p.code} - ${p.title} (${p.age}) ürünü hakkında bilgi almak istiyorum.`
        : `Hello, I would like information about ${p.code} - ${p.title} (${p.age}).`;
      const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(msg)}`;
      if (whatsappButton) whatsappButton.href = url;
      if (quickWhatsappBtn) quickWhatsappBtn.href = url;
      if (zoomImage) { zoomImage.src = p.image; zoomImage.alt = p.title; }
      
      productList?.querySelectorAll('.product-item').forEach((item) => {
        const idx = parseInt(item.getAttribute('data-index') || '0');
        item.classList.toggle('active', idx === index);
      });
    }
    
    function openZoom() { zoomModal?.classList.add('active'); document.body.style.overflow = 'hidden'; }
    function closeZoom() { zoomModal?.classList.remove('active'); document.body.style.overflow = ''; }
    
    productImageContainer?.addEventListener('click', openZoom);
    zoomCloseBtn?.addEventListener('click', closeZoom);
    zoomOverlay?.addEventListener('click', closeZoom);
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeZoom(); });
    
    categoryTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        categoryTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        activeCategory = tab.getAttribute('data-category') || 'all';
        filterProducts();
      });
    });
    
    let searchTimeout: any;
    searchInput?.addEventListener('input', () => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        searchQuery = searchInput.value.trim();
        filterProducts();
        clearSearchBtn?.classList.toggle('hidden', !searchQuery);
      }, 300);
    });
    
    clearSearchBtn?.addEventListener('click', () => {
      if (searchInput) searchInput.value = '';
      searchQuery = '';
      filterProducts();
      clearSearchBtn.classList.add('hidden');
    });
    
    clearFiltersBtn?.addEventListener('click', () => {
      if (searchInput) searchInput.value = '';
      searchQuery = '';
      activeCategory = 'all';
      categoryTabs.forEach(t => t.classList.remove('active'));
      document.querySelector('.category-tab[data-category="all"]')?.classList.add('active');
      filterProducts();
      clearSearchBtn?.classList.add('hidden');
    });
    
    prevPageBtn?.addEventListener('click', () => { if (currentPage > 0) { currentPage--; renderProductList(); } });
    nextPageBtn?.addEventListener('click', () => { if ((currentPage + 1) * itemsPerPage < filteredProducts.length) { currentPage++; renderProductList(); } });
    
    filterProducts();
  });
</script>
