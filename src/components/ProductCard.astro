---
/**
 * ProductCard.astro
 * Ürün kartı bileşeni (katalog)
 *
 * Props:
 * - product: Ürün verisi
 * - lang: Dil ('tr' | 'en')
 */
import type { CollectionEntry } from 'astro:content';

interface Props {
  product: CollectionEntry<'products'>;
  lang?: 'tr' | 'en';
  showQuoteCta?: boolean;
}

const { product, lang = 'tr', showQuoteCta = false } = Astro.props;
const { data, slug } = product;

const cleanSlug = slug.includes('/') ? slug.split('/').slice(1).join('/') : slug;
const productURL = lang === 'tr' ? `/urun/${cleanSlug}` : `/en/product/${cleanSlug}`;

const categoryLabels = {
  tr: { bebek: 'Bebek', cocuk: 'Çocuk' },
  en: { bebek: 'Baby', cocuk: 'Children' }
} as const;
const categoryLabel = categoryLabels[lang][data.category];

const featuredFeatures = data.features.slice(0, 2);

const phoneNumber = '905369205969';
const defaultWhatsAppMsg =
  lang === 'tr'
    ? `Merhaba, ${data.title} (${data.sku}) için toptan fiyat teklifi almak istiyorum.`
    : `Hello, I would like to get a wholesale price quote for ${data.title} (${data.sku}).`;
const whatsappMsg = data.whatsapp_msg || defaultWhatsAppMsg;
const whatsappURL = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(whatsappMsg)}`;
---

<article
  class="card group overflow-hidden bg-white transition-shadow hover:shadow-md group-data-[view=list]/view:flex group-data-[view=list]/view:items-stretch"
>
  <!-- Image -->
  <a
    href={productURL}
    class="relative block overflow-hidden bg-slate-50 aspect-square group-data-[view=list]/view:w-28 sm:group-data-[view=list]/view:w-32 group-data-[view=list]/view:shrink-0"
    aria-label={lang === 'tr' ? `${data.title} detay` : `View ${data.title}`}
  >
    {data.cover_image ? (
      <img
        src={data.cover_image}
        alt={data.title}
        width="640"
        height="640"
        class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-[1.03]"
        loading="lazy"
        decoding="async"
      />
    ) : (
      <div class="flex h-full w-full items-center justify-center bg-slate-100 text-slate-400">
        <svg class="h-10 w-10" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M3 5a2 2 0 012-2h14a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V5z"
          />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 11l3 3 5-6" />
        </svg>
      </div>
    )}
  </a>

  <!-- Content -->
  <div class="flex min-w-0 flex-col gap-2 p-3 sm:p-4 group-data-[view=list]/view:flex-1">
    <div class="flex flex-wrap items-center gap-2">
      <span class="badge badge-pink">{categoryLabel}</span>
      <span class="badge badge-blue">{data.sku}</span>
    </div>

    <h3 class="min-w-0 text-sm sm:text-base font-semibold leading-snug text-slate-900 group-hover:text-brand-pink transition-colors line-clamp-2">
      <a href={productURL} class="block">
        {data.title}
      </a>
    </h3>

    <p class="text-xs sm:text-sm text-slate-600 flex items-center gap-1.5">
      <svg class="w-4 h-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
        />
      </svg>
      <span class="truncate">{data.age_group}</span>
    </p>

    {featuredFeatures.length > 0 && (
      <ul class="text-xs sm:text-sm text-slate-600 space-y-1">
        {featuredFeatures.map((feature) => (
          <li class="flex items-start gap-2">
            <span class="mt-2 h-1.5 w-1.5 flex-shrink-0 rounded-full bg-brand-blue/80" aria-hidden="true" />
            <span class="min-w-0 truncate">{feature}</span>
          </li>
        ))}
      </ul>
    )}

    {showQuoteCta ? (
        <a
          href={whatsappURL}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center justify-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-700 transition-colors hover:border-whatsapp-green hover:bg-green-50 hover:text-whatsapp-green focus:outline-none focus:ring-2 focus:ring-whatsapp-green focus:ring-offset-2"
          aria-label={lang === 'tr' ? `${data.sku} için WhatsApp ile teklif al` : `Get quote for ${data.sku} on WhatsApp`}
        >
          <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
          </svg>
          <span>{lang === 'tr' ? 'WhatsApp ile Teklif Al' : 'Get Quote on WhatsApp'}</span>
        </a>

        <a
          href={productURL}
          class="ml-auto inline-flex items-center justify-center rounded-lg px-2 py-2 text-xs font-semibold text-slate-500 transition-colors hover:text-brand-blue focus:outline-none focus:ring-2 focus:ring-brand-blue focus:ring-offset-2"
        >
          {lang === 'tr' ? 'Detay' : 'Details'}
        </a>
      )}
    </div>
    {!showQuoteCta && (
      <a
        href={productURL}
        class="mt-1 inline-flex w-full items-center justify-center rounded-lg bg-slate-100 px-3 py-2 text-xs font-semibold text-slate-700 transition-colors hover:bg-brand-blue hover:text-white focus:outline-none focus:ring-2 focus:ring-brand-blue focus:ring-offset-2"
      >
        {lang === 'tr' ? 'Detayları Gör' : 'View Details'}
      </a>
    )}
  </div>
</article>
