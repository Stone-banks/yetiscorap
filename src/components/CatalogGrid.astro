---
/**
 * CatalogGrid.astro
 * Sessiz Premium Grid Katalog
 * 
 * Özellikler:
 * - Kompakt kart tasarımı (sadece görsel + sku + yaş badge)
 * - Arama, kategori filtreleme, yaş dropdown
 * - Modal/lightbox detay görünümü
 * - WhatsApp ile bilgi alma CTA
 * - Responsive grid (2/3/4 sütun)
 */

import { getCollection } from 'astro:content';

interface Props {
  lang?: 'tr' | 'en';
}

const { lang = 'tr' } = Astro.props;

// Ürünleri getir
const allProducts = await getCollection('products', ({ id }) => {
  return id.startsWith(lang === 'tr' ? 'tr/' : 'en/');
});

// Ürünleri düzenle
const products = allProducts.map(product => ({
  slug: product.slug,
  id: product.id,
  ...product.data
}));

// WhatsApp numarası (tek kaynak)
const whatsappNumber = '905369205969';

// Yaş seçenekleri (sabit liste)
const ageOptions = [
  'Tümü',
  '0-6 Ay',
  '1 Yaş',
  '2 Yaş',
  '3 Yaş',
  '4 Yaş',
  '5 Yaş',
  '6 Yaş',
  '7 Yaş',
  '8 Yaş',
  '9 Yaş',
  '10 Yaş',
  '11 Yaş',
  '12 Yaş',
  '3-5 Yaş',
  '6-12 Ay'
];

// Metinler
const texts = {
  tr: {
    title: 'Ürün Kataloğu',
    subtitle: 'Ürün kodunu seçin, WhatsApp\'tan hızlıca bilgi alın.',
    searchPlaceholder: 'Ürün kodu veya isim ara...',
    allCategories: 'Tümü',
    baby: 'Bebek',
    child: 'Çocuk',
    selectAge: 'Yaş Seç',
    allAges: 'Tümü',
    products: 'ürün',
    clearFilters: 'Temizle',
    whatsappCTA: 'WhatsApp ile Bilgi Al',
    noProducts: 'Ürün bulunamadı',
    noProductsDesc: 'Arama kriterlerinizi değiştirin veya filtreleri temizleyin.',
    loadingImage: 'Görsel hazırlanıyor',
    close: 'Kapat',
    category: 'Kategori',
    ageGroup: 'Yaş'
  },
  en: {
    title: 'Product Catalog',
    subtitle: 'Select a product code, get info quickly via WhatsApp.',
    searchPlaceholder: 'Search product code or name...',
    allCategories: 'All',
    baby: 'Baby',
    child: 'Child',
    selectAge: 'Select Age',
    allAges: 'All',
    products: 'products',
    clearFilters: 'Clear',
    whatsappCTA: 'Get Info via WhatsApp',
    noProducts: 'No products found',
    noProductsDesc: 'Change your search criteria or clear filters.',
    loadingImage: 'Image loading',
    close: 'Close',
    category: 'Category',
    ageGroup: 'Age'
  }
};

const t = texts[lang];

// WhatsApp mesaj üretici
const generateWhatsAppMsg = (sku: string, ageGroup: string) => {
  if (lang === 'tr') {
    return encodeURIComponent(`Merhaba, ${sku} kodlu (${ageGroup}) çorap hakkında bilgi almak istiyorum.`);
  }
  return encodeURIComponent(`Hello, I would like to get information about the ${sku} (${ageGroup}) socks.`);
};
---

<section id="katalog" class="section bg-slate-50">
  <div class="container">
    <!-- Section Header -->
    <div class="text-center mb-8 md:mb-10">
      <h2 class="heading-xl mb-3">{t.title}</h2>
      <p class="text-body-lg max-w-xl mx-auto">{t.subtitle}</p>
    </div>

    <!-- Filter Bar -->
    <div class="catalog-filters bg-white rounded-2xl shadow-sm border border-slate-100 p-4 mb-6">
      <div class="flex flex-col sm:flex-row gap-3 items-stretch sm:items-center">
        <!-- Search -->
        <div class="relative flex-1">
          <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <input
            type="search"
            id="catalog-search"
            placeholder={t.searchPlaceholder}
            class="w-full pl-12 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all"
          />
        </div>

        <!-- Category Chips -->
        <div class="flex gap-2" role="tablist" aria-label="Category filter">
          <button
            type="button"
            data-category="all"
            class="category-chip active px-4 py-2.5 rounded-full text-sm font-medium transition-all"
            role="tab"
            aria-selected="true"
          >
            {t.allCategories}
          </button>
          <button
            type="button"
            data-category="bebek"
            class="category-chip px-4 py-2.5 rounded-full text-sm font-medium transition-all"
            role="tab"
            aria-selected="false"
          >
            {t.baby}
          </button>
          <button
            type="button"
            data-category="cocuk"
            class="category-chip px-4 py-2.5 rounded-full text-sm font-medium transition-all"
            role="tab"
            aria-selected="false"
          >
            {t.child}
          </button>
        </div>

        <!-- Age Dropdown -->
        <div class="relative">
          <select
            id="age-filter"
            class="appearance-none w-full sm:w-auto px-4 py-3 pr-10 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all cursor-pointer"
          >
            <option value="">{t.selectAge}</option>
            {ageOptions.map(age => (
              <option value={age === 'Tümü' ? '' : age}>{age}</option>
            ))}
          </select>
          <svg class="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
          </svg>
        </div>

        <!-- Results Count & Clear -->
        <div class="flex items-center gap-3 text-sm">
          <span id="results-count" class="text-slate-500 whitespace-nowrap">
            <strong class="text-slate-800">{products.length}</strong> {t.products}
          </span>
          <button
            type="button"
            id="clear-filters"
            class="text-pink-500 hover:text-pink-600 font-medium hidden"
          >
            {t.clearFilters}
          </button>
        </div>
      </div>
    </div>

    <!-- Products Grid -->
    <div
      id="products-grid"
      class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4"
    >
      {products.map((product) => {
        const whatsappMsg = product.whatsapp_msg 
          ? encodeURIComponent(product.whatsapp_msg)
          : generateWhatsAppMsg(product.sku, product.age_group);
        
        return (
          <article
            class="product-card group cursor-pointer"
            data-sku={product.sku.toLowerCase()}
            data-title={product.title.toLowerCase()}
            data-category={product.category}
            data-age={product.age_group}
            data-whatsapp-msg={whatsappMsg}
            data-cover={product.cover_image}
            data-images={product.images ? JSON.stringify(product.images) : '[]'}
            tabindex="0"
            role="button"
            aria-label={`${product.sku} - ${product.title}`}
          >
            <div class="relative aspect-[4/5] overflow-hidden rounded-xl bg-slate-100">
              <!-- Product Image -->
              <img
                src={product.cover_image}
                alt={product.title}
                class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-[1.02]"
                loading="lazy"
                onerror="this.onerror=null; this.src='/images/placeholder.png'; this.parentElement.classList.add('img-error');"
              />
              
              <!-- SKU Badge (Sol Üst) -->
              <div class="absolute top-2 left-2">
                <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold bg-white/90 backdrop-blur-sm text-slate-800 border border-white/50 shadow-sm">
                  {product.sku}
                </span>
              </div>

              <!-- Age Badge (Sağ Alt) -->
              <div class="absolute bottom-2 right-2">
                <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-pink-500/90 backdrop-blur-sm text-white border border-pink-400/50 shadow-sm">
                  {product.age_group}
                </span>
              </div>

              <!-- Hover Overlay -->
              <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end justify-center pb-4">
                <span class="inline-flex items-center gap-2 px-4 py-2 bg-green-500 text-white text-sm font-semibold rounded-full shadow-lg transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                  </svg>
                  {t.whatsappCTA}
                </span>
              </div>

              <!-- Image Error State -->
              <div class="img-error-state absolute inset-0 flex flex-col items-center justify-center bg-slate-100 hidden">
                <svg class="w-12 h-12 text-slate-300 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                </svg>
                <span class="text-xs text-slate-400">{t.loadingImage}</span>
              </div>
            </div>
          </article>
        );
      })}
    </div>

    <!-- No Results Message -->
    <div id="no-results" class="hidden text-center py-16">
      <svg class="w-16 h-16 mx-auto text-slate-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
      </svg>
      <h3 class="text-lg font-semibold text-slate-700 mb-2">{t.noProducts}</h3>
      <p class="text-slate-500">{t.noProductsDesc}</p>
    </div>
  </div>
</section>

<!-- Product Modal -->
<div
  id="product-modal"
  class="fixed inset-0 z-[80] hidden"
  role="dialog"
  aria-modal="true"
  aria-labelledby="modal-title"
>
  <!-- Backdrop -->
  <div class="modal-backdrop absolute inset-0 bg-black/70 backdrop-blur-sm"></div>
  
  <!-- Modal Content -->
  <div class="modal-content absolute inset-4 md:inset-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 md:w-full md:max-w-lg bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
    <!-- Modal Header -->
    <div class="flex items-center justify-between p-4 border-b border-slate-100">
      <div>
        <h3 id="modal-title" class="font-bold text-slate-900"></h3>
        <div class="flex items-center gap-2 mt-1">
          <span id="modal-sku" class="text-sm font-semibold text-pink-500"></span>
          <span class="text-slate-300">•</span>
          <span id="modal-age" class="text-sm text-slate-500"></span>
          <span class="text-slate-300">•</span>
          <span id="modal-category" class="text-sm text-slate-500 capitalize"></span>
        </div>
      </div>
      <button
        type="button"
        id="modal-close"
        class="w-10 h-10 flex items-center justify-center rounded-full text-slate-400 hover:bg-slate-100 hover:text-slate-600 transition-colors"
        aria-label={t.close}
      >
        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Modal Body (Image) -->
    <div class="flex-1 overflow-hidden bg-slate-50 relative">
      <img
        id="modal-image"
        src=""
        alt=""
        class="w-full h-full object-contain"
      />
      <!-- Carousel Arrows (for future) -->
      <button
        type="button"
        id="modal-prev"
        class="absolute left-2 top-1/2 -translate-y-1/2 w-10 h-10 flex items-center justify-center rounded-full bg-white/90 shadow-md text-slate-600 hover:bg-white transition-colors hidden"
        aria-label="Previous"
      >
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
      <button
        type="button"
        id="modal-next"
        class="absolute right-2 top-1/2 -translate-y-1/2 w-10 h-10 flex items-center justify-center rounded-full bg-white/90 shadow-md text-slate-600 hover:bg-white transition-colors hidden"
        aria-label="Next"
      >
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>

    <!-- Modal Footer -->
    <div class="p-4 border-t border-slate-100">
      <a
        id="modal-whatsapp-btn"
        href="#"
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center justify-center gap-3 w-full py-4 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-xl transition-colors shadow-md"
      >
        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
          <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
        </svg>
        <span>{t.whatsappCTA}</span>
      </a>
    </div>
  </div>
</div>

<style>
  /* Category Chip Styles */
  .category-chip {
    background: rgb(241 245 249);
    color: rgb(71 85 105);
  }
  .category-chip:hover {
    background: rgb(226 232 240);
  }
  .category-chip.active {
    background: rgb(236 72 153);
    color: white;
  }

  /* Product Card */
  .product-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .product-card:hover,
  .product-card:focus-visible {
    transform: translateY(-2px);
  }
  .product-card:focus-visible {
    outline: 2px solid rgb(236 72 153);
    outline-offset: 2px;
    border-radius: 0.75rem;
  }

  /* Image Error State */
  .img-error .img-error-state {
    display: flex !important;
  }
  .img-error img {
    opacity: 0;
  }

  /* Modal Animation */
  #product-modal.show {
    display: block;
    animation: fadeIn 0.2s ease;
  }
  #product-modal.show .modal-content {
    animation: slideUp 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Desktop modal positioning fix */
  @media (min-width: 768px) {
    #product-modal.show .modal-content {
      animation: scaleIn 0.3s ease;
    }
    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }
  }
</style>

<script is:inline define:vars={{ whatsappNumber }}>
  // DOM Elements
  const searchInput = document.getElementById('catalog-search');
  const categoryChips = document.querySelectorAll('.category-chip');
  const ageFilter = document.getElementById('age-filter');
  const clearFiltersBtn = document.getElementById('clear-filters');
  const resultsCount = document.getElementById('results-count');
  const productsGrid = document.getElementById('products-grid');
  const noResults = document.getElementById('no-results');
  const productCards = document.querySelectorAll('.product-card');

  // Modal Elements
  const modal = document.getElementById('product-modal');
  const modalBackdrop = modal.querySelector('.modal-backdrop');
  const modalClose = document.getElementById('modal-close');
  const modalTitle = document.getElementById('modal-title');
  const modalSku = document.getElementById('modal-sku');
  const modalAge = document.getElementById('modal-age');
  const modalCategory = document.getElementById('modal-category');
  const modalImage = document.getElementById('modal-image');
  const modalWhatsappBtn = document.getElementById('modal-whatsapp-btn');

  // Filter State
  let currentSearch = '';
  let currentCategory = 'all';
  let currentAge = '';

  // Filter Products
  function filterProducts() {
    let visibleCount = 0;

    productCards.forEach(function(card) {
      var sku = card.dataset.sku || '';
      var title = card.dataset.title || '';
      var category = card.dataset.category || '';
      var age = card.dataset.age || '';

      var matchesSearch = !currentSearch || 
        sku.includes(currentSearch.toLowerCase()) || 
        title.includes(currentSearch.toLowerCase());
      
      var matchesCategory = currentCategory === 'all' || category === currentCategory;
      var matchesAge = !currentAge || age === currentAge;

      if (matchesSearch && matchesCategory && matchesAge) {
        card.style.display = '';
        visibleCount++;
      } else {
        card.style.display = 'none';
      }
    });

    // Update results count
    var countText = resultsCount.innerHTML;
    resultsCount.innerHTML = '<strong class="text-slate-800">' + visibleCount + '</strong> ' + countText.split(' ').slice(1).join(' ');

    // Show/hide no results
    if (visibleCount === 0) {
      noResults.classList.remove('hidden');
      productsGrid.classList.add('hidden');
    } else {
      noResults.classList.add('hidden');
      productsGrid.classList.remove('hidden');
    }

    // Show/hide clear button
    if (currentSearch || currentCategory !== 'all' || currentAge) {
      clearFiltersBtn.classList.remove('hidden');
    } else {
      clearFiltersBtn.classList.add('hidden');
    }
  }

  // Search Input
  if (searchInput) {
    searchInput.addEventListener('input', function(e) {
      currentSearch = e.target.value;
      filterProducts();
    });
  }

  // Category Chips
  categoryChips.forEach(function(chip) {
    chip.addEventListener('click', function() {
      categoryChips.forEach(function(c) {
        c.classList.remove('active');
        c.setAttribute('aria-selected', 'false');
      });
      chip.classList.add('active');
      chip.setAttribute('aria-selected', 'true');
      currentCategory = chip.dataset.category;
      filterProducts();
    });
  });

  // Age Filter
  if (ageFilter) {
    ageFilter.addEventListener('change', function(e) {
      currentAge = e.target.value;
      filterProducts();
    });
  }

  // Clear Filters
  if (clearFiltersBtn) {
    clearFiltersBtn.addEventListener('click', function() {
      currentSearch = '';
      currentCategory = 'all';
      currentAge = '';
      
      if (searchInput) searchInput.value = '';
      if (ageFilter) ageFilter.value = '';
      
      categoryChips.forEach(function(chip, index) {
        if (index === 0) {
          chip.classList.add('active');
          chip.setAttribute('aria-selected', 'true');
        } else {
          chip.classList.remove('active');
          chip.setAttribute('aria-selected', 'false');
        }
      });
      
      filterProducts();
    });
  }

  // Open Modal
  function openModal(card) {
    var title = card.getAttribute('aria-label') || '';
    var sku = card.dataset.sku || '';
    var age = card.dataset.age || '';
    var category = card.dataset.category || '';
    var cover = card.dataset.cover || '';
    var whatsappMsg = card.dataset.whatsappMsg || '';

    modalTitle.textContent = title;
    modalSku.textContent = sku.toUpperCase();
    modalAge.textContent = age;
    modalCategory.textContent = category === 'bebek' ? 'Bebek' : 'Çocuk';
    modalImage.src = cover;
    modalImage.alt = title;
    modalWhatsappBtn.href = 'https://wa.me/' + whatsappNumber + '?text=' + whatsappMsg;

    modal.classList.add('show');
    document.body.style.overflow = 'hidden';
  }

  // Close Modal
  function closeModal() {
    modal.classList.remove('show');
    document.body.style.overflow = '';
  }

  // Product Card Click
  productCards.forEach(function(card) {
    card.addEventListener('click', function() {
      openModal(card);
    });
    card.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        openModal(card);
      }
    });
  });

  // Modal Close Events
  if (modalClose) {
    modalClose.addEventListener('click', closeModal);
  }
  if (modalBackdrop) {
    modalBackdrop.addEventListener('click', closeModal);
  }
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && modal.classList.contains('show')) {
      closeModal();
    }
  });
</script>
